#!/data/data/com.termux/files/usr/bin/bash
STATEFUL="$PREFIX/share/debdroid"
STATUS="$PREFIX/share/debdroid/rootfs/usr/lib/.libdone.so.9"

RED="$(tput setaf 1)"
GREEN="$(tput setaf 2)"
YELLOW="$(tput setaf 3)"
BOLD="$(tput bold)"
NOATTR="$(tput sgr0)"

set -e -u

interrupt(){
	echo "${YELLOW}${BOLD}WARNING:${RED} Interrupt Signal Recieved... exiting${NOATTR}"
	exit 2
}

trap 'interrupt' HUP INT QUIT TERM KILL

## Validate Rootfs
if [ -e $STATUS ]; then
    exec
else
    echo "${RED}${BOLD}Debian Container isn't installed. Aborting Exit Code 2${NOATTR}"
    exit 2
fi
### Next Step
echo "${RED}${BOLD}NOTICE: Please close all your sessions before continuing. to prevent permission denials${NOATTR}"
### Ask for User Prompt
read -e -p "${GREEN}${BOLD}Please Enter the name to export your backups: ${NOATTR}" backup

### Start Backup
echo "${YELLOW}${BOLD}Backing Up. This may take a few minutes${NOATTR}"
cd $STATEFUL
proot --link2symlink -0 tar --preserve-permissions -zcf $HOME/"$backup".export rootfs >/dev/null 2>&1 || true
echo "${GREEN}${BOLD}Debian Container exported successfully.${NOATTR}"

